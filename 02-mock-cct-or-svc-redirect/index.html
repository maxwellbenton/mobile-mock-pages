<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        display: flex;
        flex-flow: column nowrap;
        justify-content: center;
        align-items: center;
      }
    </style>
    <title>Stand-In Stand-Alone DCF</title>
  </head>

  <body>
    <h1>Stand-Alone DCF</h1>
    <h2>Redirecting in...</h2>
    <h2 id="countdown">5</h2>
    <h3 id="params"></h3>
    <script>
      (function () {
        const paramsOutput = document.querySelector('#params')
        const urlParams = new URLSearchParams(window.location.search);
        const redirectParams = {};
        let ucsRedirect;
        for (const [key, value] of urlParams.entries()) {
          console.log('url param found: ' + `${key}: ${value}`);
          if (key === "redirectURL") {
            ucsRedirect = value
            paramsOutput.innerText = "\n " + key + ": " + JSON.stringify(value, null, 2)
          }
        }
        redirectParams["card-id"] = "abc-123";
        redirectParams["correlation-id"] = "correlation-id-123";
        const encodedParams = btoa(JSON.stringify(redirectParams));
        let countdown = 5;
        const countdownInterval = setInterval(() => {
          countdown--;
          document.querySelector("#countdown").innerText = countdown;
          if (countdown === 0) {
            clearInterval(countdownInterval);
            if (ucsRedirect) {
              const redirect = new URL(ucsRedirect)
              redirect.searchParams.set("dcfData", encodedParams);
              console.warn('redirecting to: ' + redirect.toString())
              window.location.href = redirect.toString();
            } else {
              document.querySelector("#countdown").innerText =
                "Error: No UCS callback found";
            }
          }
        }, 1000);
      })();
    </script>
  </body>
</html>
